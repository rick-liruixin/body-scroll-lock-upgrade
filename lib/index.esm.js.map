{"version":3,"file":"index.esm.js","sources":["../src/body-scroll-lock.ts"],"sourcesContent":["export type BodyScrollOptions = {\n  reserveScrollBarGap?: boolean | undefined;\n  allowTouchMove?: ((el: EventTarget) => boolean) | undefined;\n};\n\ntype BodyStyleType = {\n  position: string;\n  top: string;\n  left: string;\n  width: string;\n  height: string;\n  overflow: string;\n};\n\ninterface Lock {\n  targetElement: HTMLElement;\n  options: BodyScrollOptions;\n}\n\n// Older browsers don't support event options, feature detect it.\nlet hasPassiveEvents = false;\nif (typeof window !== 'undefined') {\n  const passiveTestOptions: any = {\n    get passive() {\n      hasPassiveEvents = true;\n      return undefined;\n    },\n  };\n  (window as any).addEventListener('testPassive', null, passiveTestOptions);\n  (window as any).removeEventListener('testPassive', null, passiveTestOptions);\n}\n\nconst isIosDevice =\n  typeof window !== 'undefined' &&\n  window.navigator &&\n  window.navigator.platform &&\n  (/iP(ad|hone|od)/.test(window.navigator.platform) ||\n    (window.navigator.platform === 'MacIntel' &&\n      window.navigator.maxTouchPoints > 1));\ntype HandleScrollEvent = TouchEvent;\n\nlet locks: Array<Lock> = [];\nlet locksIndex: Map<any, number> = new Map();\nlet documentListenerAdded: boolean = false;\nlet initialClientY: number = -1;\nlet previousBodyOverflowSetting: string | undefined;\nlet htmlStyle:\n  | {\n      height: string;\n      overflow: string;\n    }\n  | undefined;\nlet bodyStyle: BodyStyleType | undefined;\n\nlet previousBodyPaddingRight: string | undefined;\n\n// returns true if `el` should be allowed to receive touchmove events.\nconst allowTouchMove = (el: EventTarget): boolean =>\n  locks.some((lock) => {\n    if (lock.options.allowTouchMove && lock.options.allowTouchMove(el)) {\n      return true;\n    }\n\n    return false;\n  });\n\nconst preventDefault = (rawEvent: HandleScrollEvent): boolean => {\n  const e: any = rawEvent || window.event;\n\n  // For the case whereby consumers adds a touchmove event listener to document.\n  // Recall that we do document.addEventListener('touchmove', preventDefault, { passive: false })\n  // in disableBodyScroll - so if we provide this opportunity to allowTouchMove, then\n  // the touchmove event on document will break.\n  if (allowTouchMove(e.target)) {\n    return true;\n  }\n\n  // Do not prevent if the event has more than one touch (usually meaning this is a multi touch gesture like pinch to zoom).\n  if (e.touches.length > 1) return true;\n\n  if (e.preventDefault) e.preventDefault();\n\n  return false;\n};\n\nconst setOverflowHidden = (options?: BodyScrollOptions) => {\n  // If previousBodyPaddingRight is already set, don't set it again.\n  if (previousBodyPaddingRight === undefined) {\n    const reserveScrollBarGap =\n      !!options && options.reserveScrollBarGap === true;\n    const scrollBarGap =\n      window.innerWidth -\n      document.documentElement.getBoundingClientRect().width;\n\n    if (reserveScrollBarGap && scrollBarGap > 0) {\n      const computedBodyPaddingRight = parseInt(\n        window\n          .getComputedStyle(document.body)\n          .getPropertyValue('padding-right'),\n        10\n      );\n      previousBodyPaddingRight = document.body.style.paddingRight;\n      document.body.style.paddingRight = `${\n        computedBodyPaddingRight + scrollBarGap\n      }px`;\n    }\n  }\n\n  // If previousBodyOverflowSetting is already set, don't set it again.\n  if (previousBodyOverflowSetting === undefined) {\n    previousBodyOverflowSetting = document.body.style.overflow;\n    document.body.style.overflow = 'hidden';\n  }\n};\n\nconst restoreOverflowSetting = () => {\n  if (previousBodyPaddingRight !== undefined) {\n    document.body.style.paddingRight = previousBodyPaddingRight;\n\n    // Restore previousBodyPaddingRight to undefined so setOverflowHidden knows it\n    // can be set again.\n    previousBodyPaddingRight = undefined;\n  }\n\n  if (previousBodyOverflowSetting !== undefined) {\n    document.body.style.overflow = previousBodyOverflowSetting;\n\n    // Restore previousBodyOverflowSetting to undefined\n    // so setOverflowHidden knows it can be set again.\n    previousBodyOverflowSetting = undefined;\n  }\n};\n\nconst setPositionFixed = () =>\n  window.requestAnimationFrame(() => {\n    const $html = document.documentElement;\n    const $body = document.body;\n    // If bodyStyle is already set, don't set it again.\n    if (bodyStyle === undefined) {\n      htmlStyle = { ...$html.style };\n      bodyStyle = { ...$body.style };\n\n      // Update the dom inside an animation frame\n      const { scrollY, scrollX, innerHeight } = window;\n\n      $html.style.height = '100%';\n      $html.style.overflow = 'hidden';\n\n      $body.style.position = 'fixed';\n      $body.style.top = `${-scrollY}px`;\n      $body.style.left = `${-scrollX}px`;\n      $body.style.width = '100%';\n      $body.style.height = 'auto';\n      $body.style.overflow = 'hidden';\n\n      setTimeout(\n        () =>\n          window.requestAnimationFrame(() => {\n            // Attempt to check if the bottom bar appeared due to the position change\n            const bottomBarHeight = innerHeight - window.innerHeight;\n            if (bottomBarHeight && scrollY >= innerHeight) {\n              // Move the content further up so that the bottom bar doesn't hide it\n              $body.style.top = -(scrollY + bottomBarHeight) + 'px';\n            }\n          }),\n        300\n      );\n    }\n  });\n\nconst restorePositionSetting = () => {\n  if (bodyStyle !== undefined) {\n    // Convert the position from \"px\" to Int\n    const y = -parseInt(document.body.style.top, 10);\n    const x = -parseInt(document.body.style.left, 10);\n\n    // Restore styles\n    const $html = document.documentElement;\n    const $body = document.body;\n\n    $html.style.height = htmlStyle?.height || '';\n    $html.style.overflow = htmlStyle?.overflow || '';\n\n    $body.style.position = bodyStyle.position || '';\n    $body.style.top = bodyStyle.top || '';\n    $body.style.left = bodyStyle.left || '';\n    $body.style.width = bodyStyle.width || '';\n    $body.style.height = bodyStyle.height || '';\n    $body.style.overflow = bodyStyle.overflow || '';\n\n    // Restore scroll\n    window.scrollTo(x, y);\n\n    bodyStyle = undefined;\n  }\n};\n\n// https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollHeight#Problems_and_solutions\nconst isTargetElementTotallyScrolled = (targetElement: HTMLElement): boolean =>\n  targetElement\n    ? targetElement.scrollHeight - targetElement.scrollTop <=\n      targetElement.clientHeight\n    : false;\n\nconst handleScroll = (\n  event: HandleScrollEvent,\n  targetElement: HTMLElement\n): boolean => {\n  const clientY = event.targetTouches[0].clientY - initialClientY;\n\n  if (allowTouchMove(event.target as EventTarget)) {\n    return false;\n  }\n\n  if (targetElement && targetElement.scrollTop === 0 && clientY > 0) {\n    // element is at the top of its scroll.\n    return preventDefault(event);\n  }\n\n  if (isTargetElementTotallyScrolled(targetElement) && clientY < 0) {\n    // element is at the bottom of its scroll.\n    return preventDefault(event);\n  }\n\n  event.stopPropagation();\n  return true;\n};\n\n/**\n *\n * @param targetElement HTMLElement\n * @param options BodyScrollOptions\n * @returns void\n */\nexport const disableBodyScroll = (\n  targetElement: HTMLElement,\n  options?: BodyScrollOptions\n): void => {\n  // targetElement must be provided\n  if (!targetElement) {\n    // eslint-disable-next-line no-console\n    console.error(\n      'disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.'\n    );\n    return;\n  }\n\n  locksIndex.set(\n    targetElement,\n    locksIndex?.get(targetElement)\n      ? (locksIndex?.get(targetElement) as number) + 1\n      : 1\n  );\n  // disableBodyScroll must not have been called on this targetElement before\n  if (locks.some((lock) => lock.targetElement === targetElement)) {\n    return;\n  }\n\n  const lock = {\n    targetElement,\n    options: options || {},\n  };\n  locks = [...locks, lock];\n\n  if (isIosDevice) {\n    setPositionFixed();\n  } else {\n    setOverflowHidden(options);\n  }\n\n  if (isIosDevice) {\n    targetElement.ontouchstart = (event: HandleScrollEvent) => {\n      if (event.targetTouches.length === 1) {\n        // detect single touch.\n        initialClientY = event.targetTouches[0].clientY;\n      }\n    };\n    targetElement.ontouchmove = (event: HandleScrollEvent) => {\n      if (event.targetTouches.length === 1) {\n        // detect single touch.\n        handleScroll(event, targetElement);\n      }\n    };\n\n    if (!documentListenerAdded) {\n      document.addEventListener(\n        'touchmove',\n        preventDefault,\n        hasPassiveEvents ? { passive: false } : undefined\n      );\n      documentListenerAdded = true;\n    }\n  }\n};\n\nexport const clearAllBodyScrollLocks = (): void => {\n  if (isIosDevice) {\n    // Clear all locks ontouchstart/ontouchmove handlers, and the references.\n    locks.forEach((lock: Lock) => {\n      lock.targetElement.ontouchstart = null;\n      lock.targetElement.ontouchmove = null;\n    });\n\n    if (documentListenerAdded) {\n      (document as any).removeEventListener(\n        'touchmove',\n        preventDefault,\n        hasPassiveEvents ? { passive: false } : undefined\n      );\n      documentListenerAdded = false;\n    }\n\n    // Reset initial clientY.\n    initialClientY = -1;\n  }\n\n  if (isIosDevice) {\n    restorePositionSetting();\n  } else {\n    restoreOverflowSetting();\n  }\n\n  locks = [];\n  locksIndex.clear();\n};\n\n/**\n * @param targetElement\n * @returns void\n */\nexport const enableBodyScroll = (targetElement: HTMLElement): void => {\n  if (!targetElement) {\n    // eslint-disable-next-line no-console\n    console.error(\n      'enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.'\n    );\n    return;\n  }\n\n  locksIndex.set(\n    targetElement,\n    locksIndex?.get(targetElement)\n      ? (locksIndex?.get(targetElement) as number) - 1\n      : 0\n  );\n  if (locksIndex?.get(targetElement) === 0) {\n    locks = locks.filter((lock) => lock.targetElement !== targetElement);\n    locksIndex?.delete(targetElement);\n  }\n\n  if (isIosDevice) {\n    targetElement.ontouchstart = null;\n    targetElement.ontouchmove = null;\n\n    if (documentListenerAdded && locks.length === 0) {\n      (document as any).removeEventListener(\n        'touchmove',\n        preventDefault,\n        hasPassiveEvents ? { passive: false } : undefined\n      );\n      documentListenerAdded = false;\n    }\n  }\n\n  if (locks.length === 0) {\n    if (isIosDevice) {\n      restorePositionSetting();\n    } else {\n      restoreOverflowSetting();\n    }\n  }\n};\n"],"names":["lock"],"mappings":"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"}